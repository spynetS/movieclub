{% extends "base.html" %}
{% block display %}


	<div class="container mx-auto pt-12 grid grid-cols-3 gap-12">

		<div class=" col-span-2 flex flex-col gap-3" >
			<h1 class=" font-bold text-4xl">You Next Movie Night</h1>


			{% if user.selected_club.next_movie %}

			<div class="bg-base-300 rounded-xl p-6 flex flex-col md:flex-row items-center md:items-start gap-6 shadow-xl">
				<div class="flex-shrink-0 w-48 h-full overflow-hidden rounded-lg shadow-md">
					<img src="{{ user.selected_club.next_movie.poster }}" alt="{{ user.selected_club.next_movie.title }} poster" class="w-full h-full object-cover">
				</div>

				<div class="flex-1 flex flex-col gap-3 text-center md:text-left">
					<h2 class="text-4xl font-extrabold text-base-content leading-tight">
						<a href="{% url 'movie' user.selected_club.next_movie.imdb_id %}" class="link link-hover">{{ user.selected_club.next_movie.title }}</a>
					</h2>
					{% if user.selected_club.next_movie.imdb_rating %}
						<div class="flex items-center justify-center md:justify-start mt-4">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-warning mr-2">
								<path fill-rule="evenodd" d="M10.788 3.212a.75.75 0 0 0-.58.113l-4.404 2.876A.75.75 0 0 1 5 6.273V19.5a.75.75 0 0 0 1.055.656L12 16.513l5.945 3.643A.75.75 0 0 0 19 19.5V6.273a.75.75 0 0 0-.208-.58l-4.404-2.876a.75.75 0 0 0-.58-.113ZM12 15a.75.75 0 0 0 .75-.75V8.5h1.25a.75.75 0 0 0 0-1.5H12.75A.75.75 0 0 0 12 6.25V5a.75.75 0 0 0-1.5 0v1.25a.75.75 0 0 0-.75.75h-.25a.75.75 0 0 0 0 1.5h.25a.75.75 0 0 0 .75.75V15Z" clip-rule="evenodd" />
							</svg>
							<span class="text-lg font-bold">{{ user.selected_club.next_movie.imdb_rating }} / 10</span>
						</div>
					{% endif %}
					<p class="text-xl font-medium text-base-content/75">{{ user.selected_club.next_movie.release_date|date:"Y" }}</p>

					<p class="text-base-content/80 text-lg leading-relaxed mt-2">{{ user.selected_club.next_movie.plot }}</p>

					<a class="btn btn-accent">
						Rate
					</a>


				</div>
			</div>
			{% else %}

			<div class="bg-base-300 rounded-lg w-full items-center justify-center flex h-42">
				<div class="flex gap-5">
					<div>
						<span class="countdown font-mono text-5xl" id="days">
							<span style="--value:0;" aria-live="polite" aria-label="0">0</span>
						</span>
						days
					</div>
					<div>
						<span class="countdown font-mono text-5xl" id="hours">
							<span style="--value:0;" aria-live="polite" aria-label="0">0</span>
						</span>
						hours
					</div>
					<div>
						<span class="countdown font-mono text-5xl" id="minutes">
							<span style="--value:0;" aria-live="polite" aria-label="0">0</span>
						</span>
						min
					</div>
					<div>
						<span class="countdown font-mono text-5xl" id="seconds">
							<span style="--value:0;" aria-live="polite" aria-label="0">0</span>
						</span>
						sec
					</div>
				</div>
			</div>
			{% endif %}

			<script>
			 let intervalId;

			 function startClock() {
				 // Clear previous interval if it exists
				 if (intervalId) {
					 clearInterval(intervalId);
				 }

				 const targetDate = new Date("{{ user.selected_club.format_next_pick }}").getTime();

				 if (isNaN(targetDate)) {
					 // Handle invalid date case
					 console.error("Invalid target date for countdown.");
					 return;
				 }

				 intervalId = setInterval(() => {
					 const now = new Date().getTime();
					 const distance = targetDate - now;

					 // Time calculations for days, hours, minutes, and seconds
					 const days = Math.floor(distance / (1000 * 60 * 60 * 24));
					 const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					 const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
					 const seconds = Math.floor((distance % (1000 * 60)) / 1000);

					 // Update the countdown display
					 // (Your existing code to update the DOM elements)
					 document.getElementById("days").children[0].style.setProperty('--value', days);
					 document.getElementById("days").children[0].innerText = days;

					 document.getElementById("hours").children[0].style.setProperty('--value', hours);
					 document.getElementById("hours").children[0].innerText = hours;

					 document.getElementById("minutes").children[0].style.setProperty('--value', minutes);
					 document.getElementById("minutes").children[0].innerText = minutes;

					 document.getElementById("seconds").children[0].style.setProperty('--value', seconds);
					 document.getElementById("seconds").children[0].innerText = seconds;

					 // If the countdown is over, stop it and reset the values
					 if (distance < 0) {
						 clearInterval(countdownFunction);
						 document.getElementById("days").children[0].innerText = "0";
						 document.getElementById("hours").children[0].innerText = "0";
						 document.getElementById("minutes").children[0].innerText = "0";
						 document.getElementById("seconds").children[0].innerText = "0";
					 }
				 }, 1000);
			 }
			 startClock()
			</script>

			<p class="text-2xl font-semibold" >Polls</p>
			<div class="bg-base-300 rounded-lg w-full flex flex-col" >
				{% include "components/movies-votes.html" with movies=user.selected_club.vote_movies.all %}
			</div>

		</div>
		<div class="bg-base-300 rounded-lg p-6">
			<h2 class="text-3xl font-bold">Best rated movie</h2>

		</div>

	</div>



{% endblock %}
